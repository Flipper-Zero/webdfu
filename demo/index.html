<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Web DFU</title>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"
      integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="index.ts"></script>
  </head>
  <body>
    <p>
      <span id="status"></span>
    </p>

    <p>
      <button id="connect">Connect</button>
    </p>

    <dialog id="interfaceDialog">
      Your device has multiple DFU interfaces. Select one from the list below:

      <form id="interfaceForm" method="dialog">
        <button id="selectInterface" type="submit">Select interface</button>
      </form>
    </dialog>

    <div>
      <div id="usbInfo" style="white-space: pre"></div>
      <div id="dfuInfo" style="white-space: pre"></div>
    </div>

    <fieldset>
      <legend>Runtime mode</legend>
      <button id="detach" disabled>Detach DFU</button>
    </fieldset>

    <fieldset>
      <form id="configForm">
        <label for="transferSize">Transfer Size:</label>
        <input type="number" name="transferSize" id="transferSize" value="1024" />
        <div id="dfuseFields" hidden>
          <label for="dfuseStartAddress">DfuSe Start Address:</label>
          <input
            type="text"
            name="dfuseStartAddress"
            id="dfuseStartAddress"
            title="Initial memory address to read/write from (hex)"
            size="10"
            pattern="0x[A-Fa-f0-9]+"
          />
          <label for="dfuseUploadSize">DfuSe Upload Size:</label>
          <input type="number" name="dfuseUploadSize" id="dfuseUploadSize" min="1" />
        </div>

        <fieldset>
          <legend>Firmware Download (write to USB device)</legend>
          <p>
            <input type="file" id="firmwareFile" name="file" disabled />
          </p>

          <p>
            <button id="download" disabled>Download</button>
          </p>

          <div class="log" id="downloadLog"></div>
        </fieldset>

        <fieldset>
          <legend>Firmware Upload (read from USB device)</legend>
          <p>
            <button id="upload" disabled>Upload</button>
          </p>
          <div class="log" id="uploadLog"></div>
        </fieldset>
      </form>
    </fieldset>
  </body>
</html>
